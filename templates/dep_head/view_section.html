<link rel="icon" href="{{ url_for('static', filename='img/scheduler_logo.png') }}">
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<link rel="stylesheet" href="{{ url_for('static', filename='css/dep_head/view_section.css') }}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
{% extends "dep_head/program.html" %}

{% block content %}
<div class="table">
    <form id="add-courses-form">
        <div class="table_header">
            <p>Add Course</p>
            <div>
                <input type="text" id="block-search" placeholder="Search by Block">
                <button type="button" id="search-button">Search</button>
                </div>
            <button type="button" name="submit" id="submit" class="btn-add-to-section">Add Courses</button>
            
        </div>
        
        <input type="hidden" id="section-id" name="section-id" value="{{ section.section_id }}">
        <div class="table_section">
            <table id="course-table">
                <thead>
                    <tr>
                        <th>Check</th>
                        <th>Course Code</th>
                        <th>Course Name</th>
                        <th>Block</th>
                    </tr>
                </thead>
                <tbody id="course-tbody">
                    {% for course in all_courses %}
                        <tr>
                            <td><input class="get_value" type="checkbox" name="courses[]" value="{{ course[0] }}"></td>
                            <td>{{ course[1] }}</td>
                            <td>{{ course[2] }}</td>
                            <td>{{ course[3] }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </form>
</div>
    <div class="table">
        <div class="table_header">
            <p>Selected Courses</p>
        </div>
        
        <div class="table_section">
            <table id="selected-table">
                <thead>
                    <tr>
                        <th>Course Code</th>
                        <th>Course Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course in selected_courses %}
                        <tr>
                            <td>{{ course[1] }}</td>
                            <td>{{ course[2] }}</td>
                            <td></td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        $(document).ready(function() {
            $('#submit').click(function(e) {
                e.preventDefault(); // Prevent default form submission
                var insert = [];
                $('.get_value').each(function() {
                    if ($(this).is(":checked")) {
                        insert.push($(this).val());
                    }
                });
                
                var sectionId = $('#section-id').val(); // Assuming you have a hidden input with the section ID
                var data = {
                    section_id: sectionId,
                    course_ids: insert
                };
    
                $.ajax({
                    type: 'POST',
                    url: '/api/add-to-section',
                    data: JSON.stringify(data),
                    contentType: 'application/json',
                    success: function(response) {
                        alert('Courses added successfully to section ' + sectionId);
                        window.location.reload()
                    },
                    error: function(xhr, status, error) {   
                        alert('Error adding courses: ' + error);
                    }
                });
            });

            // Search functionality
            $('#search-button').click(function() {
                var searchValue = $('#block-search').val().toLowerCase();
                $('#course-tbody tr').each(function() {
                    var block = $(this).find('td:nth-child(4)').text().toLowerCase();
                    if (block.includes(searchValue)) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });

            // Clear search when input is empty
            $('#block-search').on('input', function() {
                if ($(this).val() === '') {
                    $('#course-tbody tr').show();
                }
            });
        });
    </script>
{% endblock %}