
    <head>
        <link rel="icon" href="{{ url_for('static', filename='img/scheduler_logo.png') }}">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/dep_head/dep_content.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/dep_head/dep_head_table.css') }}">
    </head>
    
    <body>
        {% extends "dep_head/dep_head.html" %}
        {% block content %}  
        <span class="body">
        <div class="container2">
            <div class="tab_box">
                <button class="tab_btn active">1st Year</button>
                <button class="tab_btn">2nd Year</button>
                <button class="tab_btn">3rd Year</button>
                <button class="tab_btn">4th Year</button>
                <div class="line"></div>
            </div>

            <div class="content_box">
                <div class="content active">
                    <div class="table">
                        <div class="table_header">
                            <p>1st Year Courses</p>
                        </div>
                        
                        <div class="table_section">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Course Code</th>
                                        <th>Course Name</th>
                                        <th>Block</th>
                                        <th>Type</th>
                                        <th>Units</th>
                                        <th>HPW</th>
                                        <th>Faculty</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for course in courses1 %}
                                    <tr>
                                        
                                        <td>{{ course[1] }}</td> <!-- Course Name -->
                                        <td>{{ course[2] }}</td> <!-- Block -->
                                        <td>{{ course[3] }}</td> <!-- Type -->
                                        <td>{{ course[4] }}</td> <!-- Units -->
                                        <td>{{ course[5] }}</td> <!-- hours per week -->
                                        <td>{{ course[6] }}</td> <!-- Faculty Name -->
                                        <td>{{ course[7] }}</td> <!-- Course Code -->
                                        <td>
                                            <button class="edit-btn" data-course-id="{{ course[0] }}">Edit</button>
                                            <button class="delete-btn" data-course-id="{{ course[0] }}">Delete</button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="content">
                    <div class="table">
                        <div class="table_header">
                            <p>2nd Year Courses</p>
                        </div>
                        
                        <div class="table_section">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Course Code</th>
                                        <th>Course Name</th>
                                        <th>Block</th>
                                        <th>Type</th>
                                        <th>Units</th>
                                        <th>HPW</th>
                                        <th>Faculty</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for course in courses2 %}
                                    <tr>
                                        
                                        <td>{{ course[1] }}</td> <!-- Course Name -->
                                        <td>{{ course[2] }}</td> <!-- Block -->
                                        <td>{{ course[3] }}</td> <!-- Type -->
                                        <td>{{ course[4] }}</td> <!-- Units -->
                                        <td>{{ course[5] }}</td> <!-- hours per week -->
                                        <td>{{ course[6] }}</td> <!-- Faculty Name -->
                                        <td>{{ course[7] }}</td> <!-- Course Code -->
                                        <td>
                                            <button class="edit-btn" data-course-id="{{ course[0] }}">Edit</button>
                                            <button class="delete-btn" data-course-id="{{ course[0] }}">Delete</button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="content">
                    <div class="table">
                        <div class="table_header">
                            <p>3rd Year Courses</p>
                        </div>
                        
                        <div class="table_section">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Course Code</th>
                                        <th>Course Name</th>
                                        <th>Block</th>
                                        <th>Type</th>
                                        <th>Units</th>
                                        <th>HPW</th>
                                        <th>Faculty</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for course in courses3 %}
                                    <tr>
                                        
                                        <td>{{ course[1] }}</td> <!-- Course Name -->
                                        <td>{{ course[2] }}</td> <!-- Block -->
                                        <td>{{ course[3] }}</td> <!-- Type -->
                                        <td>{{ course[4] }}</td> <!-- Units -->
                                        <td>{{ course[5] }}</td> <!-- hours per week -->
                                        <td>{{ course[6] }}</td> <!-- Faculty Name -->
                                        <td>{{ course[7] }}</td> <!-- Course Code -->
                                        <td>
                                            <button class="edit-btn" data-course-id="{{ course[0] }}">Edit</button>
                                            <button class="delete-btn" data-course-id="{{ course[0] }}">Delete</button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="content">
                    <div class="table">
                        <div class="table_header">
                            <p>4th Year Courses</p>
                        </div>
                        
                        <div class="table_section">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Course Code</th>
                                        <th>Course Name</th>
                                        <th>Block</th>
                                        <th>Type</th>
                                        <th>Units</th>
                                        <th>HPW</th>
                                        <th>Faculty</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for course in courses4 %}
                                    <tr>
                                        <td>{{ course[1] }}</td> <!-- Course Name -->
                                        <td>{{ course[2] }}</td> <!-- Block -->
                                        <td>{{ course[3] }}</td> <!-- Type -->
                                        <td>{{ course[4] }}</td> <!-- Units -->
                                        <td>{{ course[5] }}</td> <!-- hours per week -->
                                        <td>{{ course[6] }}</td> <!-- Faculty Name -->
                                        <td>{{ course[7] }}</td> <!-- Course Code -->
                                        <td>
                                            <button class="edit-btn" data-course-id="{{ course[0] }}">Edit</button>
                                            <button class="delete-btn" data-course-id="{{ course[0] }}">Delete</button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="popup">
            <div class="close-btn">&times;</div>
            <div class="form">
                <form method="POST" action="{{ url_for('my_blueprint.add_course') }}">
                    {{ form.hidden_tag() }}
                    <h2>Add Course</h2>
                    <div class="form-element">
                        <label for="course_code">Course Code</label>
                        <input type="text" id="course_code" name="course_code" placeholder="Course Code" required>
                    </div>
                    <div class="form-element">
                        <label for="course_name">Course Name</label>
                        <input type="text" id="course_name" name="course_name" placeholder="Course Name" required readonly>
                    </div>
                    <div class="form-element">
                        <label for="units">Units</label>
                        <input type="number" id="units" name="units" placeholder="Units" required readonly>
                    </div>
                    <div class="form-element">
                        <label for="hours_per_week">Hours per Week</label>
                        <input type="number" id="hours_per_week" name="hours_per_week" placeholder="Number of hours per week" required readonly>
                    </div>
                    <div class="form-element">
                        <label for="block">Block</label>
                        <input type="text" id="course_block" name="course_block" placeholder="Block ex: A, B, C..." required>
                    </div>

                    <div class="form-element">
                        <label for="type">Type</label>
                        <div class="select-box">
                        <select id="course_type" name="course_type">
                            <option value="">-- Please select --</option>
                            <option value="Lecture">Lecture</option>
                            <option value="Comp Laboratory">Comp Laboratory</option>
                            <option value="Networking">Networking</option>
                            <option value="Engineering Laboratory">Engineering Laboratory</option>
                        </select>
                    </div>
                    </div>

                    <div class="form-element">
                        <label for="year_level">Year Level</label>
                        <div class="select-box">
                        <select id="year_level" name="year_level">
                            <option value="">-- Please select --</option>
                            <option value="1st_year">1st Year</option>
                            <option value="2nd_year">2nd Year</option>
                            <option value="3rd_year">3rd Year</option>
                            <option value="4th_year">4th Year</option>
                        </select>
                        </div>
                    </div>

                    <div class="form-element">
                        <label for="faculty">Faculty</label>
                        <div class="select-box">
                        <select id="faculty" name="faculty">
                            <option value="">-- Please select --</option>
                            {% for faculty in faculty_choices %}
                            <option value="{{ faculty[0] }}">{{ faculty[1] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    </div>
                     <!-- Automatically includes the CSRF token -->
                     <div class="form-element">
                    <button type="submit">Add Course</button>
                    </div>
                </form>
            </div>
        </div>
        <button id="show-add" class="add"><i class='bx bx-plus-circle'></i></button>
    </span>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Edit button functionality
    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const courseId = this.getAttribute('data-course-id');
            window.location.href = `/edit-course/${courseId}`;
        });
    });

    // Delete button functionality
    document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            const courseId = this.getAttribute('data-course-id');
            if (confirm('Are you sure you want to delete this course?')) {
                // Send a DELETE request to your Flask route
                fetch(`/delete-course/${courseId}`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Remove the row from the table
                            this.closest('tr').remove();
                            alert('Course deleted successfully!');
                        } else {
                            alert('Failed to delete course.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while deleting the course.');
                    });
            }
        });
    });

    // Fetch course details when course code changes
    document.getElementById('course_code').addEventListener('input', function() {
        const courseCode = this.value;
        if (courseCode) {
            fetch(`/get-course-details?course_code=${courseCode}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById('course_name').value = '';
                        document.getElementById('units').value = '';
                        document.getElementById('hours_per_week').value = '';
                        document.getElementById('course_name').readOnly = false;
                        document.getElementById('units').readOnly = false;
                        document.getElementById('hours_per_week').readOnly = false;
                    } else {
                        document.getElementById('course_name').value = data.course_name;
                        document.getElementById('units').value = data.units;
                        document.getElementById('hours_per_week').value = data.hours_per_week;
                        document.getElementById('course_name').readOnly = true;
                        document.getElementById('units').readOnly = true;
                        document.getElementById('hours_per_week').readOnly = true;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        } else {
            document.getElementById('course_name').value = '';
            document.getElementById('units').value = '';
            document.getElementById('hours_per_week').value = '';
            document.getElementById('course_name').readOnly = false;
            document.getElementById('units').readOnly = false;
            document.getElementById('hours_per_week').readOnly = false;
        }
    });
});
    </script>
    {% endblock %}
    <script src="{{ url_for('static', filename='js/scripts/dep_head/dep_head.js') }}"></script>
    </body>
